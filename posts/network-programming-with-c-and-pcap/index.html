<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title></title>
<link rel="stylesheet" href="../../assets/main.css">
</head>
<body>
<div class="container"><header class="header">
                        <span class="header__inner">
                                <div class="logo">
  <span class="logo__mark">></span>
  <span class="logo__text">cd ~</span>
  <span class="logo__cursor"
  style="background-color:#ccf9f4;animation-duration:0.75s;">
  </span>
</div>

                                    <span class="header__right">
                                        <nav class="menu">
  <ul class="menu__inner">
    <li><a href="/test-site">Home</a></li>
    <li><a href="/test-site/posts/">Drafts</a></li>
  </ul>
</nav>

                                    </span>
                        </span>
                        </header><div style="margin: 0 auto; width: 40%;
                border: 1px solid black; padding: 50px;
                margin-top: 50px; text-align: left;
                font-size: 12px">
                <hr />
<p>layout: post
title: "Network programming in C"
date: 2020-11-17
categories: [c-programming]</p>
<hr />
<pre><code class="c">#include &lt;pcap.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;arpa/inet.h&gt;
#include &lt;netinet/if_ether.h&gt;
#include &lt;net/ethernet.h&gt;
#include &lt;netinet/ether.h&gt;

/*
 * workhorse function, we will be modifying this function
 */
void my_callback(u_char *args,const struct pcap_pkthdr* pkthdr,const u_char* packet)
{
}


int main(int argc,char **argv)
{
    char *dev;
    char errbuf[PCAP_ERRBUF_SIZE];
    pcap_t* descr;
    struct bpf_program fp;      /* hold compiled program     */
    bpf_u_int32 maskp;          /* subnet mask               */
    bpf_u_int32 netp;           /* ip                        */
    u_char* args = NULL;

    /* Options must be passed in as a string because I am lazy */
    if(argc &lt; 2){
        fprintf(stdout,&quot;Usage: %s numpackets \&quot;options\&quot;\n&quot;,argv[0]);
        return 0;
    }

    /* grab a device to peak into... */
    dev = pcap_lookupdev(errbuf);
    if(dev == NULL)
    { printf(&quot;%s\n&quot;,errbuf); exit(1); }

    /* ask pcap for the network address and mask of the device */
    pcap_lookupnet(dev,&amp;netp,&amp;maskp,errbuf);

    /* open device for reading. NOTE: defaulting to
     * promiscuous mode*/
    descr = pcap_open_live(dev,BUFSIZ,1,-1,errbuf);
    if(descr == NULL)
    { printf(&quot;pcap_open_live(): %s\n&quot;,errbuf); exit(1); }


    if(argc &gt; 2)
    {
        /* Lets try and compile the program.. non-optimized */
        if(pcap_compile(descr,&amp;fp,argv[2],0,netp) == -1)
        { fprintf(stderr,&quot;Error calling pcap_compile\n&quot;); exit(1); }

        /* set the compiled program as the filter */
        if(pcap_setfilter(descr,&amp;fp) == -1)
        { fprintf(stderr,&quot;Error setting filter\n&quot;); exit(1); }
    }

    /* ... and loop */
    pcap_loop(descr,atoi(argv[1]),my_callback,args);

    fprintf(stdout,&quot;\nfinished\n&quot;);
    return 0;
}
</code></pre>
                </div>
                 <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
                        <script type="text/javascript" id="MathJax-script" async
                        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
                        <script type="text/javascript" src="assets/main.js"></script></div></body>
</html>
