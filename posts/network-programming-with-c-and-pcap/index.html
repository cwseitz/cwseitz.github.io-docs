<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HTMLDocument</title>
<link rel="stylesheet" href="../../assets/main.css">
</head>
<body>
<div class="container"><header class="header">
                        <span class="header__inner">
                                
            <div class="logo">
                    <span class="logo__mark">></span>
                    <span class="logo__text">cd ~</span>
                    <span class="logo__cursor"
                    style="background-color:#008080;animation-duration:0.75s;">
                    </span>
            </div>
                                    <span class="header__right">
                                          <nav class="menu">
                <ul class="menu__inner">
                  <li><a href="posts">Drafts</a></li>
                  <li><a href="mirage">Mirage</a></li>
                  <li><a href="photos">Photography</a></li>
                </ul>
            </nav>
                                    </span>
                        </span>
                        </header>
                    <div style="margin: 0 auto; width: 50%;">
                    <hr />
<p>layout: post
title: "Network programming in C"
date: 2020-11-17
categories: [c-programming]</p>
<hr />
<p>```c</p>
<h1>include <pcap.h></h1>
<h1>include <stdio.h></h1>
<h1>include <stdlib.h></h1>
<h1>include <errno.h></h1>
<h1>include <sys/socket.h></h1>
<h1>include <netinet/in.h></h1>
<h1>include <arpa/inet.h></h1>
<h1>include <netinet/if_ether.h></h1>
<h1>include <net/ethernet.h></h1>
<h1>include <netinet/ether.h></h1>
<p>/<em>
 * workhorse function, we will be modifying this function
 </em>/
void my_callback(u_char <em>args,const struct pcap_pkthdr</em> pkthdr,const u_char* packet)
{
}</p>
<p>int main(int argc,char <em><em>argv)
{
    char </em>dev;
    char errbuf[PCAP_ERRBUF_SIZE];
    pcap_t</em> descr;
    struct bpf_program fp;      /<em> hold compiled program     </em>/
    bpf_u_int32 maskp;          /<em> subnet mask               </em>/
    bpf_u_int32 netp;           /<em> ip                        </em>/
    u_char* args = NULL;</p>
<pre><code>/* Options must be passed in as a string because I am lazy */
if(argc &lt; 2){
    fprintf(stdout,"Usage: %s numpackets \"options\"\n",argv[0]);
    return 0;
}

/* grab a device to peak into... */
dev = pcap_lookupdev(errbuf);
if(dev == NULL)
{ printf("%s\n",errbuf); exit(1); }

/* ask pcap for the network address and mask of the device */
pcap_lookupnet(dev,&amp;netp,&amp;maskp,errbuf);

/* open device for reading. NOTE: defaulting to
 * promiscuous mode*/
descr = pcap_open_live(dev,BUFSIZ,1,-1,errbuf);
if(descr == NULL)
{ printf("pcap_open_live(): %s\n",errbuf); exit(1); }


if(argc &gt; 2)
{
    /* Lets try and compile the program.. non-optimized */
    if(pcap_compile(descr,&amp;fp,argv[2],0,netp) == -1)
    { fprintf(stderr,"Error calling pcap_compile\n"); exit(1); }

    /* set the compiled program as the filter */
    if(pcap_setfilter(descr,&amp;fp) == -1)
    { fprintf(stderr,"Error setting filter\n"); exit(1); }
}

/* ... and loop */
pcap_loop(descr,atoi(argv[1]),my_callback,args);

fprintf(stdout,"\nfinished\n");
return 0;
</code></pre>
<p>}
```</p>
                    </div>
                 <script>
                  MathJax = {
                    tex: {
                      inlineMath: [['$', '$'], ['\(', '\)']],
                      displayMath: [['$$','$$'], ['\[', '\]']],
                      processEscapes: true,
                      processEnvironments: true
                    },
                    options: {
                      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
                    }
                  };

                  window.addEventListener('load', (event) => {
                      document.querySelectorAll("mjx-container").forEach(function(x){
                        x.parentElement.classList += 'has-jax'})
                    });

                </script></div></body>
</html>
