% Latex template: mahmoud.s.fahmy@students.kasralainy.edu.eg
% For more details: https://www.sharelatex.com/learn/Beamer

\documentclass[aspectratio=1610]{beamer}					% Document class

\setbeamertemplate{footline}[text line]{%
  \parbox{\linewidth}{\vspace*{-8pt}Bounding parameter uncertainty in single molecule localization\hfill\insertshortauthor\hfill\insertpagenumber}}
\setbeamertemplate{navigation symbols}{}

\usepackage[english]{babel}				% Set language
\usepackage[utf8x]{inputenc}			% Set encoding

\mode<presentation>						% Set options
{
  \usetheme{default}					% Set theme
  \usecolortheme{default} 				% Set colors
  \usefonttheme{default}  				% Set font theme
  \setbeamertemplate{caption}[numbered]	% Set caption to be numbered
}

% Uncomment this to have the outline at the beginning of each section highlighted.
%\AtBeginSection[]
%{
%  \begin{frame}{Outline}
%    \tableofcontents[currentsection]
%  \end{frame}
%}

\usepackage{graphicx}					% For including figures
\usepackage{booktabs}					% For table rules
\usepackage{hyperref}					% For cross-referencing

\title{Bounding parameter uncertainty in single molecule localization}	% Presentation title
\author{Clayton W. Seitz}								% Presentation author
\date{\today}									% Today's date	

\begin{document}

% Title page
% This page includes the informations defined earlier including title, author/s, affiliation/s and the date
\begin{frame}
  \titlepage
\end{frame}


% The following is the most frequently used slide types in beamer
% The slide structure is as follows:
%
%\begin{frame}{<slide-title>}
%	<content>
%\end{frame}

\begin{frame}{Photon statistics of CMOS cameras}

\begin{itemize}
\item Imaging noise consists of shot noise, thermal noise, and readout noise
\vspace{0.1in}
\item Shot noise is Poisson, thermal noise and readout noise are Gaussian
\end{itemize}
\vspace{0.2in}

We will adopt the Gaussian PSF approximation (image function):

\begin{equation*}
q(x,y) = \frac{1}{2\pi\sigma^{2}}\exp\left(-\frac{x^{2}+y^{2}}{2\sigma^{2}}\right)
\end{equation*}

and define the number of photoelectrons at a pixel $k$ as a sum of three random variables

\begin{equation*}
H_{\theta,k} = S_{\theta,k} + B_{\theta,k} + W_{\theta,k}
\end{equation*}

where $S_{\theta,k}$ and $B_{\theta,k}$ are Poisson processes for signal and background while $W_{\theta,k}$ represents  dark noise of a CMOS array

\end{frame}

\begin{frame}{Photon statistics of CMOS cameras}

The mean values of the signal and background processes are

\begin{equation*}
\mu_{\theta,k} = \int_{t_{0}}^{t} \Lambda(\tau) \int_{C_{k}} q(x,y)dxdyd\tau
\end{equation*}

\begin{equation*}
\beta_{\theta,k} = \int_{t_{0}}^{t} \Lambda(\tau) \int_{C_{k}} b(x,y)dxdyd\tau
\end{equation*}

where $b(x,y)$ is a spatially dependent background function. $\Lambda(\tau)$ is the emission rate as a function of time (for example exponential decay for photobleaching). 

If we take the dark noise to be Gaussian with mean $m_{\theta,k}$, then we have: 

\begin{equation*}
\nu_{\theta,k} = \mu_{\theta,k} + \beta_{\theta,k} + m_{\theta,k}
\end{equation*}
\\
\vspace{0.2in}
\textcolor{blue}{We now need to show the form of $P(H_{k})$}


\end{frame}

\begin{frame}{Monte Carlo integration over a pixel}

Computing the mean value at a pixel involves computing an integral $ \int_{C_{k}} q(x,y)dxdy$. This integral is difficult to compute, but a 2D image is really just a 2D histogram. So if we can find the PSF $q(x,y)$ from the objective lens, we can use Monte Carlo integration (sample from the normalized PSF) and multiply by the emission rate $\nu$ to compute the mean of the Poisson process at a pixel $k$


\end{frame}

\begin{frame}{Photon statistics of CMOS cameras}

Let's start by explicitly writing $P(S_{k})$

\vspace{0.2in}
For a CMOS pixel $k$, the true signal $S_{k}\; [\mathrm{ADU}]$ is a Poisson process with rate parameter $\Lambda_{k}$

\begin{equation*}
S_{k} = \gamma g_{k}P_{k}(s_{k}|\Lambda_{k})
\end{equation*}

where $\gamma\;\;[e^{-}/p]$ is the quantum efficiency and $g_{n}\;\; [\mathrm{ADU}/e^{-}]$ is the pixel's gain
\vspace{0.1in}

\begin{equation*}
P(S_{k}) = \frac{\exp\left({-\Lambda_{k}}\right)\lambda_{k}^{p}}{p!}
\end{equation*}

\textcolor{blue}{We can use this to find the distribution over the corrupted signal $P(H_{k})$}


\end{frame}


\begin{frame}{Photon statistics of CMOS cameras}

To find $P(H_{k})$, we first evaluate the joint density $P(S_{k},H_{k})$
\vspace{0.1in}
\begin{align*}
P(S_{k},H_{k}) &= P(H_{k}|S_{k}=s)P(S_{k}=s)\\
&= \frac{1}{Z}\exp\left(-\frac{(H_{k}-g_{k}s-\mu_{k})^{2}}{\sigma_{k}^{2}}\right)\frac{\exp\left({-\Lambda_{k}}\right)\Lambda_{k}^{s}}{s!}
\end{align*}
\vspace{0.1in}

Marginalizing over $S_{k}$ gives the desired distribution over $H_{n}$

\begin{equation*}
P(H_{k}) = \frac{1}{Z}\sum_{s=0}^{\infty}\frac{\exp\left({-\Lambda_{k}}\right)\Lambda_{k}^{s}}{s!}\exp\left(-\frac{(H_{k}-g_{k}s-\mu_{k})^{2}}{\sigma_{k}^{2}}\right)
\end{equation*}

\end{frame}



\begin{frame}{Fisher Information}

Consider the general prescripton of maxmimum likelihood parameter estimation:

\begin{align*}
\mathcal{E}_{\mathrm{MLE}}: \theta^{*} = \underset{\theta}{\mathrm{argmax}}\; \ell(\mathcal{D}|\theta)
\end{align*}

where $\ell = \log\mathcal{L}$ is the log-likelihood function\\
\vspace{0.1in}
\textcolor{blue}{Question: can we derive a theoretical lower bound on our uncertainty in $\theta^{*}$ for an arbitrary estimator $\mathcal{E}$?}\\
\vspace{0.1in}
Start by defining the \emph{score} of $\ell$ with respect to $\theta$ as

\begin{align*}
\mathcal{S} = \underset{{x\sim p}}{\mathbb{E}}\left[\frac{\partial}{\partial\theta} \ell(x|\theta)\right]
\end{align*}

Since $x$ is a continuous random variable, we have to consider the average score

\end{frame}

\begin{frame}{Fisher Information}

The Fisher Information $I(\theta)$ is defined as the variance of the score

\begin{align*}
I(\theta) = \underset{{x\sim p}}{\mathbb{E}}\left[\frac{\partial}{\partial\theta} \left(\ell(x|\theta)\right)\right]^{2} = \underset{{x\sim p}}{\mathbb{E}}\left[\frac{\partial^{2}}{\partial\theta^{2}} \left(\ell(x|\theta)\right)\right]
\end{align*}

for $x\in\mathcal{D}$. The variance takes this from because it can be shown that $\mathcal{S}=0$\\
\vspace{0.1in}
Intuitively, if the likelihood is insensitive changes in $\theta$, then $\mathcal{D}$ does not provide very much information about $\theta$\\

When there are many parameters, the Fisher Information (second moment of the score) is a covariance matrix

\begin{align*}
I_{ij}(\theta) = \underset{{x\sim p}}{\mathbb{E}}\left[\frac{\partial}{\partial\theta_{i}} \left(\ell(x|\theta)\right)\frac{\partial}{\partial\theta_{j}} \left(\ell(x|\theta)\right)\right]
\end{align*}


\end{frame}

\begin{frame}{Fisher Information for a multiple parameters}

We have shown that the model for the number of photoelectrons at a pixel is

\begin{equation*}
P(H_{k}) = \frac{1}{Z}\sum_{s=0}^{\infty}\frac{\exp\left({-\Lambda_{k}}\right)\Lambda_{k}^{s}}{s!}\exp\left(-\frac{(H_{k}-g_{k}s-\nu_{k})^{2}}{\sigma_{k}^{2}}\right)
\end{equation*}

Notice that $\nu_{k}$ is dependent on $\int q(x,y)dxdy$ and therefore the PSF parameters $\theta = (\mu_{x},\mu_{y},\sigma)$. These can be plugged into the following Fisher information matrix

\begin{align*}
I_{ij}(\theta) &= \underset{{H\sim P}}{\mathbb{E}}\left[\frac{\partial}{\partial\theta_{i}} \left(\log \prod_{k} P(H_{k})\right)\frac{\partial}{\partial\theta_{j}} \left(\log \prod_{k} P(H_{k})\right)\right]\\
&= \underset{{H\sim P}}{\mathbb{E}}\sum_{k}\left[\frac{\partial}{\partial\theta_{i}} \log P(H_{k})\frac{\partial}{\partial\theta_{j}} \log P(H_{k})\right]
\end{align*}

\end{frame}



\section{References}

% Adding the option 'allowframebreaks' allows the contents of the slide to be expanded in more than one slide.
\begin{frame}[allowframebreaks]{References}
	\tiny\bibliography{references}
	\bibliographystyle{apalike}
\end{frame}

\end{document}